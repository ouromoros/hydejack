---
layout: post
title: 分布式系统杂谈
tags: [CS]
categories: [Chinese]
comments: true
---
很早之前就对分布式系统产生过兴趣，只是因为种种原因一直到最近才真正对其有了认识。以前就常常能在各处地方耳闻大数据、服务器集群、spark、hadoop等名词，但习惯性地谷歌一下时又不能找到很好的文档或者教程，查询结果起到的帮助甚至比不上冷门的库和语言，只有一些模糊的描述和较为晦涩的技术细节，由此对分布式系统的探索总是不了了之，直到接触到MIT的6.824这门课，才真正打开了分布式系统这扇大门。

[6.824](https://pdos.csail.mit.edu/6.824/schedule.html)的课程涵盖了Raft、Mapreduce、GFS、DHS等大部分前沿技术，每节课讲一篇论文的内容，讲的技术由浅到深（时间顺序），并配有4个用Go语言编写的lab作为实践作业，lab和lecture notes的质量都相当好，强烈推荐。某种意义上我们从这里就可以看出来分布式系统是一门很新且比较深的技术，阅读相关论文反而是最好的学习方式，教材的作用比较有限。

*本文是作者想到哪里写到哪里的产物，不推荐用于任何严谨的参考用途，作者不为因阅读本文产生的误解、混乱、心智失常承担任何责任。*

# Why

分布式系统往往十分复杂，即使理论没有问题了其在机器上的实现也十分容易出错，那么一个聪明人应当首先问这样一个问题：**为什么我们需要分布式系统？**

是啊，既然它如此麻烦，那为什么要花这么多时间去研究它呢？这些计算机科学家的杰出大脑明明可以用在其它同样复杂的事物上，比如人工智能、区块链这些似乎更足以改变世界的技术，何必呢？

不过同样的，计算机科学家们也不是弱智（除非弱智能理解Paxos），分布式系统势必有其独有的优势，使人们对它的需求如此迫切。

## Scalability

*我有一台电脑，我还有一台电脑...BANG！我有一台性能相当于这些电脑之和的超级电脑！*

这个想法乍看之下很幼稚，但实际上它确实是分布式系统要达到的目标之一，那就是充分运用多台计算机的性能。可能有人会问一个问题：“为什么不直接使用一台性能更优的超级计算机呢？”那么我会反问回去：“为什么要呢？”一台超级计算机的复杂程度依然是惊人的，而且由于需求量较少，无法产生规模效应，出于成本上的考虑也很难得到我们的青睐，而且很显然，在灵活性上一台巨大的机器与许多独立的机器是无法比较的，因此无论从何种角度出发，一个分布式系统都是优于一台同样性能的超级计算机的。

再多说几句，就算有着摩尔定律的保证，硬件的发展依然是相对缓慢的，或许市场上一般都有满足我们需求的超级计算机，但若是没有呢？或者说，如果我们就是要追求最高的性能呢？那么将多台超级计算机连在一起组成一个“超级”分布式系统显然也是可能的选择。

## Reliability

*不要把鸡蛋放在一个篮子里。*

硬盘错误、系统崩溃、网络失败、断电、机房失火...现实中充满了数不清的问题，有的是我们可以依靠自己天才的大脑解决的，但有的却是怎么都无可奈何的，除非我们对这个世界有了完全的掌握（成为上帝的一种委婉说法），否则我们永远都不能说自己的系统是完全可靠的。

但现实又是残酷的，在很多情况下我们又不得不设法让自己的系统变得“可靠”，有时我们需要提供可靠的数据存储（银行账户、任何互联网企业），有时我们需要提供随时可以使用的服务（任何互联网企业），由于出现错误的代价十分高昂，因此必须做到就算天上开始下硫磺雨系统也能正常运转的程度。

因此我们开始变得疑神疑鬼，硬件厂商无法给我们提供绝对可靠的硬件，网络提供方也无法保证绝对可靠的网络，地方政府也无法保证绝对可靠的24小时供电，安保系统无法保证绝对不出现妨害...任何一个地方出现问题都会带来巨大的问题，难道这就是我们的命运——必须一直这样惶惶不可终日吗？

这就是为什么我们需要分布式系统：机器、硬盘不可靠——那么我们就同时使用多个机器、用多个硬盘存储数据，总不可能所有硬盘同时坏吧。安保、网络、电源等不可靠——那么我们就把系统部署到不同地方的机房里，总不可能这些地方同时出现不可抗力吧。这样我们就避免了过于依赖一个机器的可靠性、一个地方的稳定性，从而降低了系统出现问题的可能性。于是我们终于可以自信地宣布自己的服务是绝对“可靠”的，而不必再担惊受怕了。

# 未完待续

*你认为你已经知道一切了...但真的如此简单吗？*

“我们已经准备好使用分布式系统了！”或许有人看完上一节就会迫不及待地如此断言。但是...真的准备好了吗？你真的了解要如何部署一个分布式系统、设计一个分布式系统会遇到什么问题吗？如果分布式系统这样完美，那么为什么我们在生活中很少实际接触到它，而只能偶尔在一些文章中了解到它在我们看不见的地方神秘地发挥作用呢？

这就是我在下一篇文章里（大概）会讲到的问题了。